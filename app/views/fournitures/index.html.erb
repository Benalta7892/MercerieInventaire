<div class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center gap-2 mb-3">
  <h2 class="mb-0">Fournitures</h2>

  <div class="d-flex flex-column flex-sm-row gap-2 w-100 w-md-auto">
    <%= link_to "Voir tous les stocks bas", stock_bas_fournitures_path, class: "btn btn-sm btn-outline-warning w-100 w-sm-auto" %>
    <%= link_to "Liste d'achats", liste_achat_path, class: "btn btn-sm btn-outline-success w-100 w-sm-auto" %>
    <%= link_to "Ajouter une fourniture", new_fourniture_path, class: "btn btn-sm btn-primary w-100 w-sm-auto" %>
  </div>
</div>

<div class="d-flex justify-content-end mb-2">
  <span class="text-muted small">
    Valeur totale :
    <strong><%= number_to_currency(@total_value_cents / 100.0, unit: "€", format: "%n %u") %></strong>
  </span>
</div>

<%= form_with url: fournitures_path, method: :get, local: true, class: "row g-2 mb-3" do %>
  <div class="col-12 col-md-5">
    <%= text_field_tag :query,
          params[:query],
          placeholder: "Rechercher…",
          class: "form-control" %>
  </div>

  <div class="col-12 col-md-4">
    <%= select_tag :category_id,
          options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
          include_blank: "Toutes les catégories",
          class: "form-select" %>
  </div>

  <div class="col-12 col-md-3 d-flex gap-2">
    <%= submit_tag "Filtrer", class: "btn btn-outline-secondary w-100" %>

    <%= link_to "Reset",
          fournitures_path,
          class: "btn btn-outline-danger w-100" %>
  </div>
<% end %>

<% if @fournitures.empty? %>
  <p class="text-muted">Aucune fourniture pour le moment.</p>
  <%= link_to "Ajouter une fourniture",
        new_fourniture_path(return_to: request.fullpath, origin: params[:origin]),
        class: "btn btn-primary btn-sm" %>
<% else %>

  <%# ===== MOBILE (< 576px) : cartes en colonne ===== %>
  <div class="d-sm-none">
    <div class="d-flex flex-column gap-2">
      <% @fournitures.each do |f| %>
        <div class="card shadow-sm">
          <div class="card-body">

            <div class="fw-semibold mb-1">
              <%= link_to f.name,
                    fourniture_path(f, return_to: request.fullpath, origin: params[:return_to]),
                    class: "text-decoration-none" %>
            </div>

            <% if f.description.present? %>
              <div class="text-muted small mb-2">
                <%= truncate(f.description, length: 80) %>
              </div>
            <% end %>

            <div class="small text-muted mb-1">
              <strong>Catégorie :</strong> <%= f.category&.name || "—" %>
            </div>

            <div class="small text-muted mb-3">
              <strong>Quantité :</strong> <%= f.quantity %> <%= f.unit %>
            </div>

            <div class="small text-muted mb-3">
              <strong>Prix :</strong>
              <% if f.price_cents.present? %>
                <%= number_to_currency(f.price_cents / 100.0, unit: "€", format: "%n %u") %>
              <% else %>
                —
              <% end %>
            </div>

            <div class="small text-muted mb-3">
              <strong>Valeur :</strong>
              <% if f.price_cents.present? %>
                <%= number_to_currency(f.stock_value_cents / 100.0, unit: "€", format: "%n %u") %>
              <% else %>
                —
              <% end %>
            </div>

            <div class="d-grid">
              <%= button_to '<i class="fa-solid fa-cart-shopping" style="color: #1edd88;"></i>'.html_safe,
                    liste_achat_items_path(fourniture_id: f.id),
                    method: :post,
                    class: "btn btn-outline-success btn-sm w-100" %>
            </div>

          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%# ===== DESKTOP (>= 576px) : table ===== %>
  <div class="d-none d-sm-block">
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Catégorie</th>
            <th class="text-nowrap">Quantité</th>
            <th class="text-nowrap text-end">Prix</th>
            <th class="text-nowrap text-end">Valeur</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% @fournitures.each do |f| %>
            <tr>
              <td>
                <%= link_to f.name,
                      fourniture_path(f, return_to: request.fullpath, origin: params[:return_to]),
                      class: "text-decoration-none fw-semibold" %>

                <% if f.description.present? %>
                  <div class="text-muted small">
                    <%= truncate(f.description, length: 60) %>
                  </div>
                <% end %>
              </td>

              <td class="text-muted"><%= f.category&.name || "—" %></td>

              <td class="text-nowrap text-muted">
                <%= f.quantity %> <%= f.unit %>
              </td>

              <td class="text-end text-nowrap text-muted">
                <% if f.price_cents.present? %>
                  <%= number_to_currency(f.price_cents / 100.0, unit: "€", format: "%n %u") %>
                <% else %>
                  —
                <% end %>
              </td>

              <td class="text-end text-nowrap text-muted">
                <% if f.price_cents.present? %>
                  <%= number_to_currency(f.stock_value_cents / 100.0, unit: "€", format: "%n %u") %>
                <% else %>
                  —
                <% end %>
              </td>

              <td class="text-end text-nowrap">
                <%= button_to '<i class="fa-solid fa-cart-shopping" style="color: #1edd88;"></i>'.html_safe,
                      liste_achat_items_path(fourniture_id: f.id),
                      method: :post,
                      class: "btn btn-sm btn-outline-success" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

<% end %>
